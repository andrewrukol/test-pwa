<!doctype html>
<html>
    <head>
        <link rel="manifest" href="/test-pwa/manifest.json">
        <title>The App</title>
        <style>
            #setup_button {
                display: none;
            }
        </style>
        <script>
            

            let deferredPrompt; // Allows to show the install prompt
let setupButton;

function installApp() {
    // Show the prompt
    deferredPrompt.prompt();
    setupButton.disabled = true;
    // Wait for the user to respond to the prompt
    deferredPrompt.userChoice
        .then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
                console.log('PWA setup accepted');
                // hide our user interface that shows our A2HS button
                setupButton.style.display = 'none';
            } else {
                console.log('PWA setup rejected');
            }
            deferredPrompt = null;
        });
}
        </script>
    </head>
    <body>
        <h1>Калькулятор углеводов</h1>
        <div>
            Вес продукта: <input id="" type="number" value=""/> грамм
        </div>
        <button id="setup_button" onclick="installApp()">Installer</button>
        <script>
            const debug = false;
            function log(message) {
                if (!debug) {
                    return;
                }
                alert(message);
            }
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./service-worker.js')
                .then(function(registration) {
                    log("registered");
                })
                .catch(function(error) {
                    log("registration failed");
                    log(JSON.stringify(error));
                });
            }    

            window.addEventListener('beforeinstallprompt', (e) => {
    alert("beforeinstallprompt");
    // Prevent Chrome 67 and earlier from automatically showing the prompt
    e.preventDefault();
    // Stash the event so it can be triggered later.
    deferredPrompt = e;
    console.log("beforeinstallprompt fired");
    if (setupButton == undefined) {
        setupButton = document.getElementById("setup_button");
    }
    // Show the setup button
    setupButton.style.display = "inline";
    setupButton.disabled = false;
});

        </script>
    </body>
</html>